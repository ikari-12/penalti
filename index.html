<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Pênalti 2D Jogável</title>
<style>
body{
    margin:0;
    background:#111;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}
canvas{
    background:linear-gradient(#4CAF50,#2e8b57);
    border:4px solid white;
}
</style>
</head>
<body>

<canvas id="game" width="800" height="500"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const WIDTH = canvas.width;
const HEIGHT = canvas.height;

const GRAVITY = 1200;
const GOAL_Y = 80;

let lastTime = 0;
let state = "aim"; // aim | shooting

class Ball {
    constructor(){
        this.radius = 10;
        this.reset();
    }

    reset(){
        this.x = WIDTH/2;
        this.y = HEIGHT-60;
        this.vx = 0;
        this.vy = 0;
    }

    shoot(powerX,powerY){
        this.vx = powerX;
        this.vy = powerY;
    }

    update(dt){
        if(state !== "shooting") return;

        this.vy += GRAVITY * dt;
        this.x += this.vx * dt;
        this.y += this.vy * dt;
    }

    draw(){
        ctx.beginPath();
        ctx.fillStyle="white";
        ctx.arc(this.x,this.y,this.radius,0,Math.PI*2);
        ctx.fill();
    }
}

class Goalkeeper{
    constructor(){
        this.width = 110;
        this.height = 20;
        this.reset();
    }

    reset(){
        this.x = WIDTH/2 - this.width/2;
        this.y = GOAL_Y;
        this.targetX = this.x;
        this.speed = 600;
    }

    react(ballX){
        // 70% chance de acertar o lado
        let error = Math.random() < 0.3 ? (Math.random()*200-100) : 0;
        this.targetX = ballX - this.width/2 + error;
    }

    update(dt){
        let dx = this.targetX - this.x;
        this.x += dx * dt * 5;

        // limite dentro do gol
        if(this.x < 250) this.x = 250;
        if(this.x + this.width > 550) this.x = 550 - this.width;
    }

    draw(){
        ctx.fillStyle="blue";
        ctx.fillRect(this.x,this.y,this.width,this.height);
    }
}

const ball = new Ball();
const keeper = new Goalkeeper();

let goals = 0;
let attempts = 0;

let dragStart = null;

// ===== CONTROLE (ARRASTAR PARA CHUTAR) =====
canvas.addEventListener("mousedown",(e)=>{
    if(state !== "aim") return;
    const rect = canvas.getBoundingClientRect();
    dragStart = {
        x: e.clientX - rect.left,
        y: e.clientY - rect.top
    };
});

canvas.addEventListener("mouseup",(e)=>{
    if(state !== "aim" || !dragStart) return;

    const rect = canvas.getBoundingClientRect();
    const endX = e.clientX - rect.left;
    const endY = e.clientY - rect.top;

    let powerX = (dragStart.x - endX) * 6;
    let powerY = (dragStart.y - endY) * 6;

    ball.shoot(powerX, powerY);
    keeper.react(ball.x);

    state = "shooting";
    dragStart = null;
});

// ===== COLISÕES =====
function checkResult(){
    if(state !== "shooting") return;

    // defesa
    if(
        ball.y - ball.radius <= keeper.y + keeper.height &&
        ball.x + ball.radius >= keeper.x &&
        ball.x - ball.radius <= keeper.x + keeper.width
    ){
        attempts++;
        resetRound();
    }

    // gol
    if(ball.y <= GOAL_Y){
        goals++;
        attempts++;
        resetRound();
    }

    // se cair no chão
    if(ball.y > HEIGHT){
        attempts++;
        resetRound();
    }
}

function resetRound(){
    ball.reset();
    keeper.reset();
    state = "aim";
}

// ===== RENDER =====
function drawField(){
    ctx.clearRect(0,0,WIDTH,HEIGHT);

    ctx.strokeStyle="white";
    ctx.lineWidth=4;
    ctx.strokeRect(250,GOAL_Y,300,100);

    ctx.fillStyle="white";
    ctx.font="18px Arial";
    ctx.fillText("Gols: "+goals,20,30);
    ctx.fillText("Tentativas: "+attempts,20,55);

    if(state==="aim"){
        ctx.fillText("Arraste o mouse para chutar",WIDTH/2-120,HEIGHT-20);
    }
}

function gameLoop(timestamp){
    let dt = (timestamp-lastTime)/1000;
    lastTime = timestamp;

    ball.update(dt);
    keeper.update(dt);
    checkResult();

    drawField();
    ball.draw();
    keeper.draw();

    requestAnimationFrame(gameLoop);
}

requestAnimationFrame(gameLoop);
</script>

</body>
</html>
