<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Pênalti 2D Realista</title>
<style>
body{
    margin:0;
    background:#1a1a1a;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}
canvas{
    background:linear-gradient(#4CAF50,#2e8b57);
    border:4px solid white;
}
</style>
</head>
<body>

<canvas id="game" width="800" height="500"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const WIDTH = canvas.width;
const HEIGHT = canvas.height;
const GRAVITY = 900; // px/s²

let lastTime = 0;

class Ball {
    constructor(){
        this.radius = 10;
        this.reset();
    }

    reset(){
        this.x = WIDTH/2;
        this.y = HEIGHT-60;
        this.vx = 0;
        this.vy = 0;
        this.active = false;
    }

    shoot(targetX,targetY){
        let dx = targetX - this.x;
        let dy = targetY - this.y;

        let length = Math.sqrt(dx*dx+dy*dy);
        dx /= length;
        dy /= length;

        let force = 600;

        this.vx = dx * force;
        this.vy = dy * force;
        this.active = true;
    }

    update(dt){
        if(!this.active) return;

        this.vy += GRAVITY * dt;
        this.x += this.vx * dt;
        this.y += this.vy * dt;

        // Limites laterais
        if(this.x < this.radius) this.x = this.radius;
        if(this.x > WIDTH - this.radius) this.x = WIDTH - this.radius;
    }

    draw(){
        ctx.beginPath();
        ctx.fillStyle="white";
        ctx.arc(this.x,this.y,this.radius,0,Math.PI*2);
        ctx.fill();
    }
}

class Goalkeeper{
    constructor(){
        this.width = 100;
        this.height = 20;
        this.baseX = WIDTH/2 - 50;
        this.reset();
    }

    reset(){
        this.x = this.baseX;
        this.y = 80;
        this.jumping = false;
        this.reactionTime = 0.2; // segundos
        this.timer = 0;
        this.direction = 0;
    }

    react(ballX){
        this.targetX = ballX - this.width/2;
        this.jumping = true;
        this.timer = 0;
    }

    update(dt){
        if(!this.jumping) return;

        this.timer += dt;

        if(this.timer >= this.reactionTime){
            let speed = 500;
            let dx = this.targetX - this.x;
            this.x += dx * 0.1;

            // Pequeno pulo visual
            this.y = 80 - 40 * Math.sin((this.timer-this.reactionTime)*6);

            if(Math.abs(dx) < 5){
                this.jumping = false;
                this.y = 80;
            }
        }
    }

    draw(){
        ctx.fillStyle="blue";
        ctx.fillRect(this.x,this.y,this.width,this.height);
    }
}

const ball = new Ball();
const keeper = new Goalkeeper();

let goals = 0;
let attempts = 0;
let message = "";

// CONTROLE
canvas.addEventListener("mousedown",(e)=>{
    if(ball.active) return;

    const rect = canvas.getBoundingClientRect();
    const tx = e.clientX - rect.left;
    const ty = e.clientY - rect.top;

    ball.shoot(tx,ty);
    keeper.react(tx);
});

// COLISÃO
function checkCollision(){
    if(!ball.active) return;

    // Defesa
    if(
        ball.y - ball.radius <= keeper.y + keeper.height &&
        ball.x + ball.radius >= keeper.x &&
        ball.x - ball.radius <= keeper.x + keeper.width &&
        ball.y > 50
    ){
        attempts++;
        message = "DEFENDEU!";
        resetRound();
    }

    // Gol
    if(ball.y <= 50){
        goals++;
        attempts++;
        message = "GOOOOL!";
        resetRound();
    }

    // Se cair no chão
    if(ball.y > HEIGHT){
        attempts++;
        message = "ERROU!";
        resetRound();
    }
}

function resetRound(){
    ball.reset();
    keeper.reset();
}

function drawField(){
    ctx.clearRect(0,0,WIDTH,HEIGHT);

    ctx.strokeStyle="white";
    ctx.lineWidth=4;
    ctx.strokeRect(250,50,300,100);

    ctx.fillStyle="white";
    ctx.font="18px Arial";
    ctx.fillText("Gols: "+goals,20,30);
    ctx.fillText("Tentativas: "+attempts,20,55);

    ctx.font="30px Arial";
    ctx.fillText(message,WIDTH/2-70,HEIGHT/2);
}

function gameLoop(timestamp){
    let dt = (timestamp-lastTime)/1000;
    lastTime = timestamp;

    ball.update(dt);
    keeper.update(dt);
    checkCollision();

    drawField();
    ball.draw();
    keeper.draw();

    requestAnimationFrame(gameLoop);
}

requestAnimationFrame(gameLoop);
</script>

</body>
</html>
